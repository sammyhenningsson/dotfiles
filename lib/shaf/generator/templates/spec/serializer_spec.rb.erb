require 'spec_helper'
require 'ostruct'

describe <%= class_name %> do

  let(:resource) do
    <%= model_class_name %>.new.
      tap { |<%= name %>| <%= name %>.id = 5 }
  end
  let(:user) { OpenStruct.new(id: 5, name: 'Bengt') }

  describe "when current_user is nil" do
    before do
      serialize resource
    end

    it "serializes attributes" do
<% attributes.each do |attr| -%>
      attributes.keys.must_include(<%= attr %>)
<% end -%>
    end

    it "serializes links" do
<% ['self', 'doc:up'].each do |rel| -%>
      link_rels.must_include(:'<%= rel %>')
<% end -%>
    end
  end

  describe "when current_user is present" do
    before do
      serialize resource, current_user: user
    end

    it "serializes attributes" do
<% attributes.each do |attr| -%>
      attributes.keys.must_include(<%= attr %>)
<% end -%>
    end

    it "serializes links" do
<% links.each do |rel| -%>
      link_rels.must_include(:'<%= rel %>')
<% end -%>
    end
  end
end

